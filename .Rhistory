if(length(triple.grep.idx(pat, tp, dt, panels[pan][[1]]))!=0) {
m2[s, pan] = "X"
} else {
m2[s, pan] = ""
}
} else {
if (length(double.grep.idx(pat, tp, panels[pan][[1]]))!=0) {
m2[s, pan] = "X"
} else {
m2[s, pan] = ""
}
}
}
}
dt
ctdna_fractions[triple.grep.idx(pat, tp, dt, ctdna_fractions$V1),]
ctdna_fractions <- read.delim("~/R/Projects/ozm-054/clinical/ctdna_fractions.tsv", header=FALSE, stringsAsFactors=FALSE)
for (s in rownames(m2)) {
splitted <- strsplit(s, "-")[[1]]
pat <- paste(splitted[1:2], collapse="-")
tp <- splitted[3]
if (tp=="Other") {
dt <- splitted[4]
m2[s, "ctDNA%"] = ctdna_fractions[triple.grep.idx(pat, tp, dt, ctdna_fractions$V1),2]
} else {
m2[s, "ctDNA%"] = ctdna_fractions[double.grep.idx(pat, tp, ctdna_fractions$V1),2]
}
for (pan in names(panels)) {
if (tp=="Other") {
if(length(triple.grep.idx(pat, tp, dt, panels[pan][[1]]))!=0) {
m2[s, pan] = "X"
} else {
m2[s, pan] = ""
}
} else {
if (length(double.grep.idx(pat, tp, panels[pan][[1]]))!=0) {
m2[s, pan] = "X"
} else {
m2[s, pan] = ""
}
}
}
}
triple.grep.idx(pat, tp, dt, ctdna_fractions$V1)
pt
pat
dt
tp
ctdna_fractions <- read.delim("~/R/Projects/ozm-054/clinical/ctdna_fractions.tsv", header=FALSE, stringsAsFactors=FALSE)
for (s in rownames(m2)) {
splitted <- strsplit(s, "-")[[1]]
pat <- paste(splitted[1:2], collapse="-")
tp <- splitted[3]
if (tp=="Other") {
dt <- splitted[4]
m2[s, "ctDNA%"] = ctdna_fractions[triple.grep.idx(pat, tp, dt, ctdna_fractions$V1),2]
} else {
m2[s, "ctDNA%"] = ctdna_fractions[double.grep.idx(pat, tp, ctdna_fractions$V1),2]
}
for (pan in names(panels)) {
if (tp=="Other") {
if(length(triple.grep.idx(pat, tp, dt, panels[pan][[1]]))!=0) {
m2[s, pan] = "X"
} else {
m2[s, pan] = ""
}
} else {
if (length(double.grep.idx(pat, tp, panels[pan][[1]]))!=0) {
m2[s, pan] = "X"
} else {
m2[s, pan] = ""
}
}
}
}
View(m2)
`73` <- read.table("~/R/Projects/ozm-054/clinical/73gene_panel_alignment_files.txt", quote="\"", comment.char="", stringsAsFactors=FALSE)[,1]
AR <- read.csv("~/R/Projects/ozm-054/clinical/ar_panel_alignment_files.txt", sep="", stringsAsFactors=FALSE)[,1]
Intron <- read.table("~/R/Projects/ozm-054/clinical/intron_panel_alignment_files.txt", quote="\"", comment.char="", stringsAsFactors=FALSE)[,1]
ctdna_fractions <- read.delim("~/R/Projects/ozm-054/clinical/ctdna_fractions.tsv", header=FALSE, stringsAsFactors=FALSE)
patients <- read.delim("~/R/Projects/ozm-054/clinical/patients.txt", header=FALSE, stringsAsFactors=FALSE)[,1]
panels <- list("73"=`73`, "AR"=AR, "Intron"=Intron)
timepoints <- c("Baseline", "Progression1", "Progression2")
samples <- unname(sapply(`73`, function(s) {
splitted <- strsplit(s, "-")[[1]]
if (splitted[5] == "Other") {
paste(splitted[c(3:5, length(splitted))], collapse="-")
} else {
paste(splitted[3:5], collapse="-")
}
}))
samples <- samples[!sapply(samples, grepl, pattern="WBC")]
m1 <- matrix(ncol=9, nrow=length(patients))
rownames(m1) <- patients
colnames(m1) <-c("73 Baseline", "73 Progression1", "73 Progression2", "AR Baseline", "AR Progression1", "AR Progression2", "Intron Baseline", "Intron Progression1", "Intron Progression2")
for (pat in rownames(m1)) {
for (tp in timepoints) {
for (pan in names(panels)) {
if (length(double.grep.idx(pat, tp, panels[pan][[1]]))!=0) {
m1[pat, paste(pan, tp)] = "X"
} else {
m1[pat, paste(pan, tp)] = ""
}
}
}
}
m2 <- matrix(nrow=length(samples), ncol=4)
rownames(m2) <- samples
colnames(m2) <- c("ctDNA%", "73", "AR", "Intron")
for (s in rownames(m2)) {
splitted <- strsplit(s, "-")[[1]]
pat <- paste(splitted[1:2], collapse="-")
tp <- splitted[3]
if (tp=="Other") {
dt <- splitted[4]
m2[s, "ctDNA%"] = ctdna_fractions[triple.grep.idx(pat, tp, dt, ctdna_fractions$V1),2]
} else {
m2[s, "ctDNA%"] = ctdna_fractions[double.grep.idx(pat, tp, ctdna_fractions$V1),2]
}
for (pan in names(panels)) {
if (tp=="Other") {
if(length(triple.grep.idx(pat, tp, dt, panels[pan][[1]]))!=0) {
m2[s, pan] = "X"
} else {
m2[s, pan] = ""
}
} else {
if (length(double.grep.idx(pat, tp, panels[pan][[1]]))!=0) {
m2[s, pan] = "X"
} else {
m2[s, pan] = ""
}
}
}
}
View(m1)
View(m2)
m2 <- matrix(nrow=length(samples), ncol=6)
rownames(m2) <- samples
colnames(m2) <- c("Patient", "Timepoint", "ctDNA%", "73", "AR", "Intron")
for (s in rownames(m2)) {
splitted <- strsplit(s, "-")[[1]]
pat <- paste(splitted[1:2], collapse="-")
tp <- splitted[3]
if (tp=="Other") {
dt <- splitted[4]
m2[s, "ctDNA%"] = ctdna_fractions[triple.grep.idx(pat, tp, dt, ctdna_fractions$V1),2]
m2[s, "Patient"] = pat
m2[s, "Timepoint"] = paste(tp, dt, collapse="-")
} else {
m2[s, "ctDNA%"] = ctdna_fractions[double.grep.idx(pat, tp, ctdna_fractions$V1),2]
m2[s, "Patient"] = pat
m2[s, "Timepoint"] = tp
}
for (pan in names(panels)) {
if (tp=="Other") {
if(length(triple.grep.idx(pat, tp, dt, panels[pan][[1]]))!=0) {
m2[s, pan] = "X"
} else {
m2[s, pan] = ""
}
} else {
if (length(double.grep.idx(pat, tp, panels[pan][[1]]))!=0) {
m2[s, pan] = "X"
} else {
m2[s, pan] = ""
}
}
}
}
View(m2)
paste(tp, dt, collapse="-")
paste(tp, dt, collapse=".")
for (s in rownames(m2)) {
splitted <- strsplit(s, "-")[[1]]
pat <- paste(splitted[1:2], collapse="-")
tp <- splitted[3]
if (tp=="Other") {
dt <- splitted[4]
m2[s, "ctDNA%"] = ctdna_fractions[triple.grep.idx(pat, tp, dt, ctdna_fractions$V1),2]
m2[s, "Patient"] = pat
m2[s, "Timepoint"] = paste0(tp, "-", dt)
} else {
m2[s, "ctDNA%"] = ctdna_fractions[double.grep.idx(pat, tp, ctdna_fractions$V1),2]
m2[s, "Patient"] = pat
m2[s, "Timepoint"] = tp
}
for (pan in names(panels)) {
if (tp=="Other") {
if(length(triple.grep.idx(pat, tp, dt, panels[pan][[1]]))!=0) {
m2[s, pan] = "X"
} else {
m2[s, pan] = ""
}
} else {
if (length(double.grep.idx(pat, tp, panels[pan][[1]]))!=0) {
m2[s, pan] = "X"
} else {
m2[s, pan] = ""
}
}
}
}
View(m2)
samples_old <- read.delim("~/R/Projects/ozm-054/clinical/samples_old.txt", stringsAsFactors=FALSE)
View(samples_old)
samples_old[2,1]
for (i in 1:nrow(samples_old)) {
if (samples_old[i,1] == "") samples_old[i,1] = samples_old[i-1,1]
})
for (i in 1:nrow(samples_old)) {
if (samples_old[i,1] == "") samples_old[i,1] = samples_old[i-1,1]
}
View(samples_old)
View(m2)
samples_old$Patient <- gsub(samples_old$Patient, pattern="054-", replacement="")
View(samples_old)
samples_old$Intron.panel. <- gsub(samples_old$Intron.panel., pattern="TODO", replacement="X")
View(samples_old)
`old&new` <- read.delim("~/R/Projects/ozm-054/clinical/sample renaming/sample names old&new.txt", header=FALSE, stringsAsFactors=FALSE)
View(`old&new`)
oldnew <- read.delim("~/R/Projects/ozm-054/clinical/sample renaming/sample names old&new.txt", header=FALSE, stringsAsFactors=FALSE)
for (i in 1:nrow(samples_old)) {
print(strsplit(oldnew[double.grep.idx(samples_old[i,1], samples_old[i,2], oldnew[,1]),2], "-")[[1]][5])
}
debugSource('~/R/Projects/ozm-054/clinical/scripts/sample matrix.R', echo=TRUE)
c
c
oldnew[,1]
samples_old[i,2]
samples_old
samples_old[i,2]
samples_old[i,1]
oldnew[,1]
oldnew[double.grep.idx(samples_old[i,1], samples_old[i,2], oldnew[,1]),2]
for (i in 1:nrow(samples_old)) {
if (samples_old[i,2] != "") {
print(strsplit(oldnew[double.grep.idx(samples_old[i,1], samples_old[i,2], oldnew[,1]),2], "-")[[1]][5])
}
}
debugSource('~/R/Projects/ozm-054/clinical/scripts/sample matrix.R', echo=TRUE)
source('~/R/Projects/ozm-054/clinical/scripts/sample matrix.R', echo=TRUE)
double.grep.idx(samples_old[i,1], samples_old[i,2], oldnew[,1])
samples_old[i,1]
samples_old[i,2]
oldnew[280,1]
oldnew[280,1]="OZM-054-901-005-End-C4-Post-Crossover-cfDNA-UMI-2018Mar13"
for (i in 1:nrow(samples_old)) {
if (samples_old[i,2] != "") {
print(strsplit(oldnew[double.grep.idx(samples_old[i,1], samples_old[i,2], oldnew[,1]),2], "-")[[1]][5])
}
}
for (i in 1:nrow(samples_old)) {
if (samples_old[i,2] != "") {
samples_old[i,2]=strsplit(oldnew[double.grep.idx(samples_old[i,1], samples_old[i,2], oldnew[,1]),2], "-")[[1]][5]
}
}
View(samples2)
View(samples_old)
View(m2)
View(samples_old)
rownames(m2) <- 1:nrow(m2)
View(m2)
View(samples_old)
oldnew[,2]
for (i in 1:nrow(samples_old)) {
if (samples_old[i,2] != "") {
splitted <- strsplit(oldnew[double.grep.idx(samples_old[i,1], samples_old[i,2], oldnew[,1]),2], "-")[[1]]
tp <- splitted[5]
if (tp=="Other") {
tp <- paste0(tp, "-", splitted[length(splitted)])
}
samples_old[i,2]=tp
}
}
samples_old <- read.delim("~/R/Projects/ozm-054/clinical/samples_old.txt", stringsAsFactors=FALSE)
for (i in 1:nrow(samples_old)) {
if (samples_old[i,1] == "") samples_old[i,1] = samples_old[i-1,1]
}
samples_old$Patient <- gsub(samples_old$Patient, pattern="054-", replacement="")
samples_old$Intron.panel. <- gsub(samples_old$Intron.panel., pattern="TODO", replacement="X")
for (i in 1:nrow(samples_old)) {
if (samples_old[i,2] != "") {
splitted <- strsplit(oldnew[double.grep.idx(samples_old[i,1], samples_old[i,2], oldnew[,1]),2], "-")[[1]]
tp <- splitted[5]
if (tp=="Other") {
tp <- paste0(tp, "-", splitted[length(splitted)])
}
samples_old[i,2]=tp
}
}
View(samples_old)
View(m2)
colnames(samples_old) <- c("Patient", "Timepoint", "ctDNA%", "73", "AR", "Intron")
View(samples_old)
AR <- read.csv("~/R/Projects/ozm-054/clinical/ar_panel_alignment_files.txt", sep="", stringsAsFactors=FALSE)[,1]
AR
View(m1)
triple.grep.idx("002-002", "Other", "28Mar13", panels[pan][[1]]))
triple.grep.idx("002-002", "Other", "28Mar13", panels[pan][[1]])
triple.grep.idx("002-002", "Other", "28Mar13", panels["AR"][[1]])
AR
AR[2]
AR[2]="OZM-054-001-001-Progression2-cfDNA-2018Mar13"
m2 <- matrix(nrow=length(samples), ncol=6)
rownames(m2) <- samples
colnames(m2) <- c("Patient", "Timepoint", "ctDNA%", "73", "AR", "Intron")
for (s in rownames(m2)) {
splitted <- strsplit(s, "-")[[1]]
pat <- paste(splitted[1:2], collapse="-")
tp <- splitted[3]
if (tp=="Other") {
dt <- splitted[4]
m2[s, "ctDNA%"] = ctdna_fractions[triple.grep.idx(pat, tp, dt, ctdna_fractions$V1),2]
m2[s, "Patient"] = pat
m2[s, "Timepoint"] = paste0(tp, "-", dt)
} else {
m2[s, "ctDNA%"] = ctdna_fractions[double.grep.idx(pat, tp, ctdna_fractions$V1),2]
m2[s, "Patient"] = pat
m2[s, "Timepoint"] = tp
}
for (pan in names(panels)) {
if (tp=="Other") {
if(length(triple.grep.idx(pat, tp, dt, panels[pan][[1]]))!=0) {
m2[s, pan] = "X"
} else {
m2[s, pan] = ""
}
} else {
if (length(double.grep.idx(pat, tp, panels[pan][[1]]))!=0) {
m2[s, pan] = "X"
} else {
m2[s, pan] = ""
}
}
}
}
rownames(m2) <- 1:nrow(m2)
View(m2)
View(samples_old)
triple.grep.idx(002-002, "Other", "2018Mar13", panels["AR"][[1]])
panels["AR"][[1]]
triple.grep.idx("002-002", "Other", "2018Mar13", panels["AR"][[1]])
AR[[1]][8]
AR[8]
panels["AR"]
panels["AR"][[1]]
panels["AR"][[1]][8]
panels["AR"][[1]][8]="OZM-054-002-002-Other-cfDNA-2018Mar13"
m2 <- matrix(nrow=length(samples), ncol=6)
rownames(m2) <- samples
colnames(m2) <- c("Patient", "Timepoint", "ctDNA%", "73", "AR", "Intron")
for (s in rownames(m2)) {
splitted <- strsplit(s, "-")[[1]]
pat <- paste(splitted[1:2], collapse="-")
tp <- splitted[3]
if (tp=="Other") {
dt <- splitted[4]
m2[s, "ctDNA%"] = ctdna_fractions[triple.grep.idx(pat, tp, dt, ctdna_fractions$V1),2]
m2[s, "Patient"] = pat
m2[s, "Timepoint"] = paste0(tp, "-", dt)
} else {
m2[s, "ctDNA%"] = ctdna_fractions[double.grep.idx(pat, tp, ctdna_fractions$V1),2]
m2[s, "Patient"] = pat
m2[s, "Timepoint"] = tp
}
for (pan in names(panels)) {
if (tp=="Other") {
if(length(triple.grep.idx(pat, tp, dt, panels[pan][[1]]))!=0) {
m2[s, pan] = "X"
} else {
m2[s, pan] = ""
}
} else {
if (length(double.grep.idx(pat, tp, panels[pan][[1]]))!=0) {
m2[s, pan] = "X"
} else {
m2[s, pan] = ""
}
}
}
}
rownames(m2) <- 1:nrow(m2)
View(samples_old)
View(m2)
paste0(m2[,1], m2[,2])
match(paste0(m2[,1], m2[,2]), paste0(samples_old[,1], samples_old[,2]))
paste0(m2[193,1], m2[193,2])
samples <- unname(sapply(`73`, function(s) {
splitted <- strsplit(s, "-")[[1]]
if (splitted[5] == "Other") {
paste(splitted[c(3:5, length(splitted))], collapse="-")
} else {
paste(splitted[3:5], collapse="-")
}
}))
samples <- samples[!sapply(samples, grepl, pattern="WBC")]
m1 <- matrix(ncol=9, nrow=length(patients))
rownames(m1) <- patients
colnames(m1) <-c("73 Baseline", "73 Progression1", "73 Progression2", "AR Baseline", "AR Progression1", "AR Progression2", "Intron Baseline", "Intron Progression1", "Intron Progression2")
for (pat in rownames(m1)) {
for (tp in timepoints) {
for (pan in names(panels)) {
if (length(double.grep.idx(pat, tp, panels[pan][[1]]))!=0) {
m1[pat, paste(pan, tp)] = "X"
} else {
m1[pat, paste(pan, tp)] = ""
}
}
}
}
m2 <- matrix(nrow=length(samples), ncol=6)
rownames(m2) <- samples
colnames(m2) <- c("Patient", "Timepoint", "ctDNA%", "73", "AR", "Intron")
for (s in rownames(m2)) {
splitted <- strsplit(s, "-")[[1]]
pat <- paste(splitted[1:2], collapse="-")
tp <- splitted[3]
if (tp=="Other") {
dt <- splitted[4]
m2[s, "ctDNA%"] = ctdna_fractions[triple.grep.idx(pat, tp, dt, ctdna_fractions$V1),2]
m2[s, "Patient"] = pat
m2[s, "Timepoint"] = paste0(tp, "-", dt)
} else {
m2[s, "ctDNA%"] = ctdna_fractions[double.grep.idx(pat, tp, ctdna_fractions$V1),2]
m2[s, "Patient"] = pat
m2[s, "Timepoint"] = tp
}
for (pan in names(panels)) {
if (tp=="Other") {
if(length(triple.grep.idx(pat, tp, dt, panels[pan][[1]]))!=0) {
m2[s, pan] = "X"
} else {
m2[s, pan] = ""
}
} else {
if (length(double.grep.idx(pat, tp, panels[pan][[1]]))!=0) {
m2[s, pan] = "X"
} else {
m2[s, pan] = ""
}
}
}
}
paste0(m2[193,1], m2[193,2])
`73` <- read.table("~/R/Projects/ozm-054/clinical/73gene_panel_alignment_files.txt", quote="\"", comment.char="", stringsAsFactors=FALSE)[,1]
samples <- unname(sapply(`73`, function(s) {
splitted <- strsplit(s, "-")[[1]]
if (splitted[5] == "Other") {
paste(splitted[c(3:5, length(splitted))], collapse="-")
} else {
paste(splitted[3:5], collapse="-")
}
}))
samples <- samples[!sapply(samples, grepl, pattern="WBC")]
m2 <- matrix(nrow=length(samples), ncol=6)
rownames(m2) <- samples
colnames(m2) <- c("Patient", "Timepoint", "ctDNA%", "73", "AR", "Intron")
for (s in rownames(m2)) {
splitted <- strsplit(s, "-")[[1]]
pat <- paste(splitted[1:2], collapse="-")
tp <- splitted[3]
if (tp=="Other") {
dt <- splitted[4]
m2[s, "ctDNA%"] = ctdna_fractions[triple.grep.idx(pat, tp, dt, ctdna_fractions$V1),2]
m2[s, "Patient"] = pat
m2[s, "Timepoint"] = paste0(tp, "-", dt)
} else {
m2[s, "ctDNA%"] = ctdna_fractions[double.grep.idx(pat, tp, ctdna_fractions$V1),2]
m2[s, "Patient"] = pat
m2[s, "Timepoint"] = tp
}
for (pan in names(panels)) {
if (tp=="Other") {
if(length(triple.grep.idx(pat, tp, dt, panels[pan][[1]]))!=0) {
m2[s, pan] = "X"
} else {
m2[s, pan] = ""
}
} else {
if (length(double.grep.idx(pat, tp, panels[pan][[1]]))!=0) {
m2[s, pan] = "X"
} else {
m2[s, pan] = ""
}
}
}
}
rownames(m2) <- 1:nrow(m2)
paste0(m2[193,1], m2[193,2])
rownames(m2)
samples
panels <- list("73"=`73`, "AR"=AR, "Intron"=Intron)
samples
`73`
paste0(m2[193,1], m2[193,2])
match(paste0(m2[,1], m2[,2]), paste0(samples_old[,1], samples_old[,2]))
View(m2[match(paste0(m2[,1], m2[,2]), paste0(samples_old[,1], samples_old[,2])),])
View(samples_old[match(paste0(m2[,1], m2[,2]), paste0(samples_old[,1], samples_old[,2])),])
m2[61,"AR"]="X"
m2[63,"AR"]=""
m2[142,"AR"]="X"
m2[144,"AR"]=""
m2[281,"AR"]=""
m2[280,"AR"]=""
m2[280,"AR"]="X"
View(samples_old[match(paste0(m2[,1], m2[,2]), paste0(samples_old[,1], samples_old[,2])),])
samples_old[match(paste0(m2[,1], m2[,2]), paste0(samples_old[,1], samples_old[,2])),] == m2
apply(samples_old[match(paste0(m2[,1], m2[,2]), paste0(samples_old[,1], samples_old[,2])),] == m2, 1, function(r) all(r))
m2[apply(samples_old[match(paste0(m2[,1], m2[,2]), paste0(samples_old[,1], samples_old[,2])),] == m2, 1, function(r) all(r)),]
write.table(m2, "~/R/Projects/ozm-054/clinical/samples_new.txt", row.names=F, col.names=T, quote=F, sep="\t")
View(m1)
